<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: "وبسایت رسمی تمنا" }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
</head>
<body>
    {% include header.html %}

    <main>
        {{ content }}
    </main>
    
    {% include footer.html %}
    
    <script>
        const poemsUrl = "https://raw.githubusercontent.com/emenmousavi/tamannah/main/poems.json";
        fetch(poemsUrl)
            .then(response => response.json())
            .then(data => {
                const randomIndex = Math.floor(Math.random() * data.length);
                const poem = data[randomIndex];
                document.getElementById('poem-title').textContent = poem.title;
                document.getElementById('poem-text').textContent = poem.text;
            })
            .catch(err => console.error("خطا در بارگذاری اشعار:", err));
        
        const audio = document.getElementById('declamationAudio');
        const playPauseButton = document.getElementById('playPauseButton');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const progressBarContainer = document.querySelector('.progress-bar-container');
        const progressBar = document.querySelector('.progress-bar');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }
        playPauseButton.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
            } else {
                audio.pause();
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            }
        });
        audio.addEventListener('timeupdate', () => {
            const progress = (audio.currentTime / audio.duration) * 100;
            progressBar.style.width = `${progress}%`;
            currentTimeEl.textContent = formatTime(audio.currentTime);
        });
        audio.addEventListener('loadedmetadata', () => {
            durationEl.textContent = formatTime(audio.duration);
        });
        audio.addEventListener('ended', () => {
            playIcon.style.display = 'block';
            pauseIcon.style.display = 'none';
            audio.currentTime = 0;
            progressBar.style.width = '0%';
        });
        progressBarContainer.addEventListener('click', (e) => {
            const clickPosition = e.offsetX;
            const containerWidth = progressBarContainer.clientWidth;
            const newTime = (clickPosition / containerWidth) * audio.duration;
            audio.currentTime = newTime;
        });
    </script>
</body>
</html>
